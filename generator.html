<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>パターン生成/Siteswap Generator</title>
    <meta name="description" content="サイトスワップパターンを生成できる【サイトスワップマスター】">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@800&display=swap');

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 800;
        }

        input,
        button,
        select,
        textarea {
            font-family: inherit;
        }

        /* フッターの特定要素は標準フォントに戻す */
        footer .contact,
        footer p {
            font-family: sans-serif;
            font-weight: normal;
        }

        /* ジェネレーター専用スタイル */
        .generator-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            color: #112D4E;
        }

        .form-group .hint {
            font-size: 12px;
            color: #666;
            margin-top: -4px;
        }

        input[type="text"],
        input[type="number"] {
            width: 95%;
            max-width: 400px;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #DBE2EF;
            border-radius: 10px;
            outline: none;
            transition: all 0.3s ease;
            background: #F9F7F7;
            color: #112D4E;
        }

        input[type="number"]:focus {
            border-color: #3F72AF;
            box-shadow: 0 0 0 3px rgba(63, 114, 175, 0.1);
        }

        /* ラジオボタングループ */
        .radio-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            background: #F9F7F7;
            border: 2px solid #DBE2EF;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: normal;
        }

        .radio-group input[type="radio"] {
            display: none;
        }

        .radio-group input[type="radio"]:checked+span {
            color: #F9F7F7;
        }

        .radio-group label:has(input[type="radio"]:checked) {
            background: #3F72AF;
            border-color: #3F72AF;
            color: #F9F7F7;
        }

        /* チェックボックス */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        /* 結果カード */
        .result-summary {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 16px;
            background: #e8f5e9;
            border-radius: 10px;
            margin-bottom: 16px;
        }

        .result-summary .count {
            font-size: 18px;
            font-weight: bold;
            color: #112D4E;
        }

        .result-hint {
            font-size: 14px;
            color: #666;
            margin-bottom: 16px;
        }

        /* 結果チップ */
        .results-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin: 16px 0;
        }

        .result-chip {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            padding: 8px 16px;
            background: #DBE2EF;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            font-family: monospace;
            color: #112D4E;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            border: none;
        }

        .result-chip:hover {
            background: #3F72AF;
            color: #F9F7F7;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(63, 114, 175, 0.3);
        }

        /* ページネーション */
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 16px 0;
        }

        .pagination .page-info {
            font-weight: bold;
            color: #112D4E;
        }

        .btn-outline {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            background: transparent;
            color: #3F72AF;
            border: 2px solid #3F72AF;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-outline:hover {
            background: #3F72AF;
            color: #F9F7F7;
        }

        .btn-outline:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* エラーカード */
        .error-card {
            display: none;
            padding: 12px 16px;
            background: #ffebee;
            border-radius: 10px;
            color: #d32f2f;
            margin-top: 16px;
        }

        .error-card.visible {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ステータスカード */
        .status-card {
            display: none;
            padding: 12px 16px;
            background: #F9F7F7;
            border-radius: 10px;
            margin-top: 16px;
        }

        .status-card.visible {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* 生成ボタン */
        .generate-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 16px;
            background: #3F72AF;
            color: #F9F7F7;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 24px;
        }

        .generate-btn:hover:not(:disabled) {
            background: #2E5A8E;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(63, 114, 175, 0.3);
        }

        .generate-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* 結果セクション */
        #results-section {
            display: none;
        }

        #results-section.visible {
            display: block;
        }

        /* 区切り線 */
        .divider {
            border: none;
            border-top: 2px solid #DBE2EF;
            margin: 24px 0;
        }

        /* モーダル */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .modal-overlay.visible {
            display: flex;
        }

        .modal-content {
            background: #F9F7F7;
            border-radius: 16px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 2px solid #DBE2EF;
            position: sticky;
            top: 0;
            background: #F9F7F7;
            border-radius: 16px 16px 0 0;
        }

        .modal-header h3 {
            margin: 0;
            color: #3F72AF;
            font-size: 20px;
            font-family: monospace;
            max-width: calc(100% - 50px);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
            padding: 0;
            line-height: 1;
        }

        .modal-close:hover {
            color: #112D4E;
        }

        .modal-body {
            padding: 20px;
        }

        /* シミュレーションコンテナ */
        .simulation-container {
            width: 100%;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }

        .simulation-container iframe {
            width: 300px;
            aspect-ratio: 3 / 5;
            border: none;
            border-radius: 8px;
        }

        /* 接続情報 */
        .connection-info {
            background: #F9F7F7;
            border-radius: 10px;
        }

        .connection-info h4 {
            color: #3F72AF;
            margin: 0 0 12px 0;
            font-size: 16px;
        }

        .connection-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 12px;
            background: #DBE2EF;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .connection-item:last-child {
            margin-bottom: 0;
        }

        .connection-label {
            font-size: 12px;
            color: #666;
        }

        .connection-value {
            font-family: monospace;
            font-size: 16px;
            font-weight: bold;
            color: #112D4E;
            word-break: break-all;
        }

        .connection-loading {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            color: #666;
        }

        .connection-error {
            padding: 12px;
            background: #ffebee;
            border-radius: 8px;
            color: #d32f2f;
            font-size: 14px;
        }

        /* シミュレーションページへのリンク */
        .simulation-link {
            display: block;
            text-align: center;
            padding: 12px;
            background: #3F72AF;
            color: #F9F7F7;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 16px;
            transition: all 0.3s ease;
        }

        .simulation-link:hover {
            background: #2E5A8E;
        }
    </style>
    <link rel="stylesheet" href="simulation.css?ver=9.3.0">
</head>

<body>
    <div class="container">
        <div id="loading" class="loader">
            <p>Loading...</p>
        </div>
        <header id="title-wrapper">
            <a href="home" class="titleText">
                <h1><span>サイトスワップ</span><span>マスター</span></h1>
            </a>
        </header>

        <main>
            <!-- セクション1: 生成フォーム -->
            <section>
                <h2>パターン生成</h2>
                <p>条件を指定してサイトスワップパターンを生成できます。</p>

                <div class="generator-form">
                    <div class="form-group">
                        <label for="ballInput">ボールの数</label>
                        <input type="text" id="ballInput" placeholder="0〜35">
                        <span class="hint">※10以上はa=10, b=11, c=12...のようにアルファベットでも入力可能</span>
                    </div>
                </div>

                <!-- 詳細設定アコーディオン -->
                <div class="accordion settings-accordion" style="margin-top: 16px;">
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <span>詳細設定</span>
                            <span class="accordion-icon">▼</span>
                        </div>
                        <div class="accordion-content">
                            <div style="padding: 16px;">
                                <div class="generator-form">
                                    <div class="form-group">
                                        <label for="periodInput">周期数</label>
                                        <input type="text" id="periodInput" placeholder="未入力の場合は1〜5周期">
                                        <span class="hint">※0〜10の範囲で指定</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="maxhInput">高さの上限</label>
                                        <input type="text" id="maxhInput" placeholder="未入力の場合は35">
                                        <span class="hint">※0〜35の範囲で指定。10以上はアルファベットでも入力可能</span>
                                    </div>

                                    <div class="form-group">
                                        <label for="excNumInput">除きたい数値</label>
                                        <input type="text" id="excNumInput" placeholder="カンマ区切り(例: 0,2,a)">
                                    </div>

                                    <div class="form-group">
                                        <label>数値順</label>
                                        <div class="radio-group">
                                            <label>
                                                <input type="radio" name="sortOrder" value="ascending">
                                                <span>昇順</span>
                                            </label>
                                            <label>
                                                <input type="radio" name="sortOrder" value="descending" checked>
                                                <span>降順</span>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label>出力順</label>
                                        <div class="radio-group">
                                            <label>
                                                <input type="radio" name="outputOrder" value="ascending" checked>
                                                <span>昇順</span>
                                            </label>
                                            <label>
                                                <input type="radio" name="outputOrder" value="descending">
                                                <span>降順</span>
                                            </label>
                                        </div>
                                    </div>

                                    <hr class="divider">

                                    <div class="checkbox-group">
                                        <label>
                                            <input type="checkbox" id="isRandom">
                                            <span>ランダム出力</span>
                                        </label>
                                        <span class="hint">指定した数だけランダムに取得</span>
                                    </div>

                                    <div class="form-group" id="randomCountGroup" style="display: none;">
                                        <label for="randomCountInput">ランダム出力数</label>
                                        <input type="text" id="randomCountInput" value="10" placeholder="取得するパターン数">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="generate-btn" id="generateBtn">生成</button>

                <div class="status-card" id="statusCard">
                    <div class="spinner"></div>
                    <span id="statusMessage">生成しています...</span>
                </div>

                <div class="error-card" id="errorCard">
                    <span id="errorMessage"></span>
                </div>
            </section>

            <!-- セクション2: 結果表示 -->
            <section id="results-section">
                <h2>生成結果</h2>

                <div class="result-summary">
                    <span class="count">計算結果: <span id="resultCount">0</span>個</span>
                </div>
                <p class="result-hint">パターンをクリックすると、シミュレーションと接続サイトスワップを表示します</p>

                <div class="pagination" id="paginationTop">
                    <button class="btn-outline" id="prevBtnTop" disabled>前へ</button>
                    <span class="page-info" id="pageInfoTop">1〜100件</span>
                    <button class="btn-outline" id="nextBtnTop">次へ</button>
                </div>

                <div class="results-container" id="resultsContainer"></div>

                <div class="pagination" id="paginationBottom">
                    <button class="btn-outline" id="prevBtnBottom" disabled>前へ</button>
                    <span class="page-info" id="pageInfoBottom">1〜100件</span>
                    <button class="btn-outline" id="nextBtnBottom">次へ</button>
                </div>
            </section>
        </main>

        <footer>
            <a href="home" class="back-home-footer">ホームに戻る</a>
            <a href="https://www.twitter.com/messages/compose?recipient_id=869867240644005889" id="contact"
                class="contact" aria-label="contact" target="_blank" rel="noopener noreferrer">
                質問・要望
            </a>
            <p>&copy; 2021-2026 サイトスワップマスター</p>
        </footer>
    </div>

    <!-- モーダル -->
    <div class="modal-overlay" id="patternModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalPatternTitle">-</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="simulation-container">
                    <iframe id="simulationFrame" src="" scrolling="no"></iframe>
                </div>
                <div class="connection-info">
                    <h4>基底状態からの接続</h4>
                    <div id="connectionContent">
                        <div class="connection-loading">
                            <div class="spinner"></div>
                            <span>計算中...</span>
                        </div>
                    </div>
                </div>
                <a href="#" class="simulation-link" id="simulationLink" target="_blank">シミュレーションページで開く</a>
            </div>
        </div>
    </div>

    <script>
        window.onload = function () {
            const spinner = document.getElementById('loading');
            spinner.classList.add('loaded');
        }

        // アコーディオンの動作
        document.querySelectorAll('.accordion-header').forEach(function (header) {
            header.addEventListener('click', function () {
                const accordionItem = this.parentElement;
                accordionItem.classList.toggle('active');
            });
        });
    </script>
    <script src="siteswapGenerator.js?ver=1.0.0"></script>
    <script src="siteswapProcessor.js?ver=1.1.3"></script>
    <script src="siteswapLab.js?ver=1.5.2"></script>
    <script>
        // 状態管理
        let results = [];
        let displayStart = 0;
        const displayCount = 100;

        // DOM要素
        const ballInput = document.getElementById('ballInput');
        const periodInput = document.getElementById('periodInput');
        const maxhInput = document.getElementById('maxhInput');
        const excNumInput = document.getElementById('excNumInput');
        const randomCountInput = document.getElementById('randomCountInput');
        const isRandomCheckbox = document.getElementById('isRandom');
        const randomCountGroup = document.getElementById('randomCountGroup');
        const generateBtn = document.getElementById('generateBtn');
        const statusCard = document.getElementById('statusCard');
        const statusMessage = document.getElementById('statusMessage');
        const errorCard = document.getElementById('errorCard');
        const errorMessage = document.getElementById('errorMessage');
        const resultsSection = document.getElementById('results-section');
        const resultsContainer = document.getElementById('resultsContainer');
        const resultCount = document.getElementById('resultCount');

        // モーダル要素
        const patternModal = document.getElementById('patternModal');
        const modalClose = document.getElementById('modalClose');
        const modalPatternTitle = document.getElementById('modalPatternTitle');
        const simulationFrame = document.getElementById('simulationFrame');
        const connectionContent = document.getElementById('connectionContent');
        const simulationLink = document.getElementById('simulationLink');

        // ランダムチェックボックスの変更イベント
        isRandomCheckbox.addEventListener('change', function () {
            randomCountGroup.style.display = this.checked ? 'block' : 'none';
        });

        // 全角数字を半角に変換
        function convertFullWidthToHalfWidth(input) {
            const fullWidthNumbers = '０１２３４５６７８９';
            const halfWidthNumbers = '0123456789';
            let result = input;
            for (let i = 0; i < fullWidthNumbers.length; i++) {
                result = result.split(fullWidthNumbers[i]).join(halfWidthNumbers[i]);
            }
            return result;
        }

        // アルファベット(a-z, A-Z)を数値(10-35)に変換
        function convertAlphabetToNumber(input) {
            let result = '';
            for (let i = 0; i < input.length; i++) {
                const char = input[i];
                const code = char.charCodeAt(0);
                if (code >= 97 && code <= 122) { // a-z
                    result += (code - 97 + 10).toString();
                } else if (code >= 65 && code <= 90) { // A-Z
                    result += (code - 65 + 10).toString();
                } else {
                    result += char;
                }
            }
            return result;
        }

        // ページネーション更新
        function updatePagination() {
            const start = displayStart + 1;
            const end = Math.min(displayStart + displayCount, results.length);
            const pageInfo = `${start}〜${end}件`;

            document.getElementById('pageInfoTop').textContent = pageInfo;
            document.getElementById('pageInfoBottom').textContent = pageInfo;

            const hasPrev = displayStart > 0;
            const hasNext = displayStart + displayCount < results.length;

            document.getElementById('prevBtnTop').disabled = !hasPrev;
            document.getElementById('prevBtnBottom').disabled = !hasPrev;
            document.getElementById('nextBtnTop').disabled = !hasNext;
            document.getElementById('nextBtnBottom').disabled = !hasNext;
        }

        // 結果を表示
        function displayResults() {
            resultsContainer.innerHTML = '';

            const displayItems = results.slice(displayStart, displayStart + displayCount);

            displayItems.forEach(pattern => {
                const chip = document.createElement('button');
                chip.className = 'result-chip';
                chip.textContent = pattern;
                chip.title = 'クリックしてシミュレーション';
                chip.addEventListener('click', function () {
                    openPatternModal(pattern);
                });
                resultsContainer.appendChild(chip);
            });

            updatePagination();
        }

        // モーダルを開く
        function openPatternModal(pattern) {
            modalPatternTitle.textContent = pattern;

            // シミュレーションのiframeを設定
            const encodedPattern = encodeURIComponent(pattern);
            simulationFrame.src = `embed?encoded-pattern=${encodedPattern}`;

            // シミュレーションページへのリンクを設定
            simulationLink.href = `simulation?encoded-pattern=${encodedPattern}`;

            // 接続情報をローディング状態に
            connectionContent.innerHTML = `
                <div class="connection-loading">
                    <div class="spinner"></div>
                    <span>計算中...</span>
                </div>
            `;

            // モーダルを表示
            patternModal.classList.add('visible');
            document.body.style.overflow = 'hidden';

            // 接続サイトスワップを計算
            setTimeout(() => {
                calculateConnection(pattern);
            }, 100);
        }

        // 接続サイトスワップを計算
        function calculateConnection(pattern) {
            try {
                // 基底状態からの接続を計算（pattern1を空にすると基底状態が補完される）
                const result = SiteswapLab.calculateConnectionPattern('', pattern);

                if (!result.isValid || !result.isJugglable) {
                    connectionContent.innerHTML = `
                        <div class="connection-error">${result.message || '接続の計算に失敗しました'}</div>
                    `;
                    return;
                }

                const data = result.data;

                connectionContent.innerHTML = `
                    <div class="connection-item">
                        <span class="connection-label">基底状態</span>
                        <span class="connection-value">${data.pattern1}</span>
                    </div>
                    <div class="connection-item">
                        <span class="connection-label">基底状態 → 入力パターン</span>
                        <span class="connection-value">${data.connection || '(なし)'}</span>
                    </div>
                    <div class="connection-item">
                        <span class="connection-label">入力パターン → 基底状態</span>
                        <span class="connection-value">${data.reverseConnection || '(なし)'}</span>
                    </div>
                    <div class="connection-item">
                        <span class="connection-label">完全ループ</span>
                        <span class="connection-value">${data.fullConnection || '(なし)'}</span>
                    </div>
                `;
            } catch (e) {
                connectionContent.innerHTML = `
                    <div class="connection-error">エラー: ${e.message}</div>
                `;
            }
        }

        // モーダルを閉じる
        function closePatternModal() {
            patternModal.classList.remove('visible');
            document.body.style.overflow = '';
            simulationFrame.src = '';
        }

        // モーダルを閉じるイベント
        modalClose.addEventListener('click', closePatternModal);
        patternModal.addEventListener('click', function (e) {
            if (e.target === patternModal) {
                closePatternModal();
            }
        });
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape' && patternModal.classList.contains('visible')) {
                closePatternModal();
            }
        });

        // 前のページ
        function showPrevious() {
            displayStart = Math.max(0, displayStart - displayCount);
            displayResults();
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // 次のページ
        function showNext() {
            displayStart = Math.min(results.length - 1, displayStart + displayCount);
            displayResults();
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ページネーションボタンのイベント
        document.getElementById('prevBtnTop').addEventListener('click', showPrevious);
        document.getElementById('prevBtnBottom').addEventListener('click', showPrevious);
        document.getElementById('nextBtnTop').addEventListener('click', showNext);
        document.getElementById('nextBtnBottom').addEventListener('click', showNext);

        // 生成処理
        function generate() {
            // 入力値の取得と変換
            const ballHalfWidth = convertFullWidthToHalfWidth(ballInput.value.trim());
            const periodHalfWidth = convertFullWidthToHalfWidth(periodInput.value.trim());
            const maxhHalfWidth = convertFullWidthToHalfWidth(maxhInput.value.trim());
            const excNumHalfWidth = excNumInput.value.trim()
                .split(',')
                .map(e => convertFullWidthToHalfWidth(e.trim()))
                .filter(e => e !== '')
                .join(',');
            const randomCountHalfWidth = convertFullWidthToHalfWidth(randomCountInput.value.trim());

            // 入力フィールドを更新
            ballInput.value = ballHalfWidth;
            periodInput.value = periodHalfWidth;
            maxhInput.value = maxhHalfWidth;
            if (excNumHalfWidth) excNumInput.value = excNumHalfWidth;
            randomCountInput.value = randomCountHalfWidth;

            // JavaScript用に変換
            const ballConverted = convertAlphabetToNumber(ballHalfWidth);
            const periodConverted = convertAlphabetToNumber(periodHalfWidth);
            const maxhConverted = maxhHalfWidth === '' ? '35' : convertAlphabetToNumber(maxhHalfWidth);
            const excNumConverted = excNumHalfWidth === '' ? [] :
                excNumHalfWidth.split(',')
                    .map(e => parseInt(convertAlphabetToNumber(e.trim())))
                    .filter(e => !isNaN(e));

            // ソート順と出力順を取得
            const sortOrder = document.querySelector('input[name="sortOrder"]:checked').value;
            const outputOrder = document.querySelector('input[name="outputOrder"]:checked').value;
            const isDescending = sortOrder === 'descending';
            const isReverseOutput = outputOrder === 'ascending';
            const isRandom = isRandomCheckbox.checked;

            // 状態を更新
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<span class="spinner" style="width:20px;height:20px;border-width:2px;"></span><span>生成中...</span>';
            statusCard.classList.add('visible');
            statusMessage.textContent = '生成しています...';
            errorCard.classList.remove('visible');
            resultsSection.classList.remove('visible');
            results = [];
            displayStart = 0;

            // 少し遅延を入れてUIを更新してから処理を実行
            setTimeout(() => {
                try {
                    const ball = parseInt(ballConverted);
                    const period = periodConverted === '' ? null : parseInt(periodConverted);
                    const maxh = parseInt(maxhConverted);
                    const randomCount = parseInt(randomCountHalfWidth) || 10;

                    let result;
                    if (isRandom) {
                        result = SiteswapGenerator.createRandom(
                            ball,
                            period,
                            maxh,
                            isDescending,
                            excNumConverted,
                            isReverseOutput,
                            randomCount
                        );
                    } else {
                        result = SiteswapGenerator.create(
                            ball,
                            period,
                            maxh,
                            isDescending,
                            excNumConverted,
                            isReverseOutput
                        );
                    }

                    results = result.results || [];
                    const error = result.error || '';

                    // 結果を表示
                    if (results.length > 0) {
                        resultCount.textContent = results.length;
                        displayResults();
                        resultsSection.classList.add('visible');

                        // 結果セクションまでスクロール
                        setTimeout(() => {
                            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                    }

                    // エラーメッセージを表示
                    if (error) {
                        errorMessage.textContent = error;
                        errorCard.classList.add('visible');
                    }

                } catch (e) {
                    errorMessage.textContent = 'エラーが発生しました: ' + e.message;
                    errorCard.classList.add('visible');
                } finally {
                    generateBtn.disabled = false;
                    generateBtn.textContent = '生成';
                    statusCard.classList.remove('visible');
                }
            }, 50);
        }

        // 生成ボタンのイベント
        generateBtn.addEventListener('click', generate);

        // Enterキーで生成
        [ballInput, periodInput, maxhInput, excNumInput, randomCountInput].forEach(input => {
            input.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    generate();
                }
            });
        });
    </script>
</body>

</html>